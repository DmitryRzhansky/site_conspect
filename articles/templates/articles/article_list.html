{% extends "main/base.html" %}
{% block content %}
<h2>Статьи</h2>

<form method="get" action="{% url 'article_list' %}">
  <input type="text" name="search" placeholder="Поиск по статьям" value="{{ search_query }}">
  <select name="category">
    <option value="">Все категории</option>
    {% for category in categories %}
      <option value="{{ category.name }}" {% if category_filter == category.name %}selected{% endif %}>
        {{ category.name }}
      </option>
    {% endfor %}
  </select>
  <button type="submit">Фильтровать</button>
</form>

<ul style="list-style: none; padding: 0;">
  {% for article in page_obj %}
  <li style="margin-bottom: 1em; padding: 1em; border: 1px solid #eee; border-radius: 5px;">
    <a href="{{ article.source_url }}" target="_blank" rel="noopener noreferrer" style="font-size: 1.2em; font-weight: bold;">
      {{ article.title }}
    </a>
    {% if article.author %}
      <p style="margin: 0.3em 0; color: #666;">Автор: {{ article.author }}</p>
    {% endif %}
    {% if article.publication_date %}
      <p style="margin: 0.3em 0; color: #666;">Дата публикации: {{ article.publication_date }}</p>
    {% endif %}
    {% if article.categories.exists %}
      <p style="margin: 0.3em 0;">
        Категории: 
        {% for category in article.categories.all %}
          <a href="{% url 'articles_by_category' category.slug %}" style="margin-right: 0.5em; color: #4a6ea9;">
            {{ category.name }}
          </a>
        {% endfor %}
      </p>
    {% endif %}
  </li>
  {% empty %}
  <li>Статей по вашему запросу не найдено.</li>
  {% endfor %}
</ul>

<div class="pagination">
  {% if page_obj.has_previous %}
    <a href="?page={{ page_obj.previous_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if category_filter %}&category={{ category_filter }}{% endif %}">
      « Назад
    </a>
  {% else %}
    <span>« Назад</span>
  {% endif %}

  <span>Страница {{ page_obj.number }} из {{ page_obj.paginator.num_pages }}</span>

  {% if page_obj.has_next %}
    <a href="?page={{ page_obj.next_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if category_filter %}&category={{ category_filter }}{% endif %}">
      Вперед »
    </a>
  {% else %}
    <span>Вперед »</span>
  {% endif %}
</div>
{% endblock %}