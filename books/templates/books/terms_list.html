{% extends "main/base.html" %}

{% block title %}Словарь терминов{% endblock %}

{% block content %}
<h2>Словарь терминов</h2>

<form method="get" action="{% url 'terms_list' %}" class="filter-form">
  <div class="form-row">
    <input type="text" name="search" placeholder="Поиск по терминам и определениям" value="{{ search_query }}" id="term-search">
    <select name="category">
      <option value="">Все категории</option>
      {% for category in categories %}
        <option value="{{ category.name }}" {% if category_filter == category.name %}selected{% endif %}>
          {{ category.name }}
        </option>
      {% endfor %}
    </select>
  </div>
  <button type="submit" class="filter-button">Применить фильтры</button>
  <a href="{% url 'terms_list' %}" class="clear-filters">Сбросить фильтры</a>
</form>

<br>

<div id="terms-container">
  <ul id="terms-list">
    {% for term in page_obj %}
    <li id="term-{{ term.slug }}" class="term-item">
      <a href="{% url 'term_detail' term.slug %}" class="term-link">
        <strong>{{ term.name }}</strong>
      </a>
      {% if term.categories.exists %}
        <div class="term-categories">
          {% for category in term.categories.all %}
            <a href="{% url 'terms_by_category' category.slug %}" class="category-tag">{{ category.name }}</a>
          {% endfor %}
        </div>
      {% endif %}
      {% if term.definition %}
        <div class="term-preview">{{ term.definition|striptags|truncatewords:20 }}</div>
      {% endif %}
    </li>
    {% empty %}
    <li class="no-results">Терминов по вашему запросу не найдено.</li>
    {% endfor %}
  </ul>
</div>

<div class="pagination">
  {% if page_obj.has_previous %}
    <a href="?page={{ page_obj.previous_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if category_filter %}&category={{ category_filter }}{% endif %}">
      « Назад
    </a>
  {% else %}
    <span>« Назад</span>
  {% endif %}

  <span>Страница {{ page_obj.number }} из {{ page_obj.paginator.num_pages }}</span>

  {% if page_obj.has_next %}
    <a href="?page={{ page_obj.next_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if category_filter %}&category={{ category_filter }}{% endif %}">
      Вперед »
    </a>
  {% else %}
    <span>Вперед »</span>
  {% endif %}
</div>


<script>
function filterTerms() {
  const input = document.getElementById('term-search').value.toLowerCase();
  const terms = document.querySelectorAll('.term-item');
  
  terms.forEach(term => {
    const text = term.textContent.toLowerCase();
    term.style.display = text.includes(input) ? '' : 'none';
  });
}

document.getElementById('term-search').addEventListener('input', filterTerms);
</script>
{% endblock %}